package ucw.tests.claimcenter;

import org.testng.annotations.*;
import ucw.pages.claimcenter.ClaimCenter;
import ucw.pages.policycenter.PolicyCenter;
import ucw.tests.BaseTest;

import static org.testng.Assert.assertTrue;
import static ucw.enums.AccountType.Company;
import static ucw.enums.Labels.SPOTICAR;
import static ucw.enums.ManagementType.INSURED;
import static ucw.utils.extentreports.ExtentTestManager.startTest;

//UCWAR-303
public class ClaimClosureReopenTest extends BaseTest {
    private PolicyCenter policyCenter;
    private ClaimCenter claimCenter;

    @BeforeClass
    public void goToClaimCenter() {
        startTest("UCWAR-303: Reserve not re-opened when claim is re-opened after closure");
        basePage.selectLabel(SPOTICAR)
                .selectManagementType(INSURED)
                .selectRandomCountry()
                .selectRandomCoverageType()
                .setAccountTypeAs(Company);
        policyCenter = basePage.loginPolicyCenter();
        claimCenter = basePage.loginClaimCenter();
        basePage.getDataObject().getClaimCenter().setQuoteAmount(100);
        basePage.getDataObject().getClaimCenter().setQuoteRef(1234);
        basePage.getDataObject().getClaimCenter().setInvoiceRef(12345);
        basePage.getDataObject().getClaimCenter().setPaymentAmount(110);
        basePage.getDataObject().getClaimCenter().setInvoiceAmount1(100);
    }

    @Test(description = "Claim closure reopen")
    public void test_closureReopenClaim() {
        basePage.switchToPolicyCenterTab();
        policyCenter.navigateToAdministrationPage();
        policyCenter.atAdministrationPage().setupDealer();
        policyCenter.navigateToAccountPage();
        policyCenter.atAccountPage().createNewAccount();
        policyCenter.atAccountPage().navigateToSubmissionPage();
        policyCenter.atAccountPage().selectGVO();
        policyCenter.atPolicyPage().createNewPolicy();
        assertTrue(policyCenter.atPolicyPage().isPolicyCreated(), "Policy Center account creation is failed");

        basePage.switchToClaimCenterTab();
        claimCenter.navigateToNewClaimPage();
        claimCenter.atClaimPage().createClaim();
        assertTrue(claimCenter.atClaimPage().isClaimCreated(), "Claim creation is failed");

        claimCenter.atClaimPage().checkStatus();
        claimCenter.atClaimPage().reserveClaim();

        claimCenter.atClaimPage().closeExposure();
        claimCenter.atClaimPage().closeClaim();

        claimCenter.atClaimPage().reopenClaim();
        claimCenter.atClaimPage().reserveClaim();
    }
}
